---
import { Image } from 'astro:assets'
import FormattedDate from '../../components/ui/FormattedDate.astro'
import AppPage from '../../layouts/AppPage.astro'
import Content from '../../layouts/Content.astro'
import { SITE_TITLE } from '@src/consts'
import Spacer from '@src/components/ui/Spacer.astro'
import HyperLink from '@src/components/ui/HyperLink.astro'
import { truncateDescription } from '@components/hooks/truncateDescription'
import { project } from '@components/hooks/fetchProject.ts'
import TagIcon from '@src/components/ui/TagIcon.astro'

type PaginateFunction = (array: any[], options: { pageSize: number }) => any

export async function getStaticPaths({ paginate }: { paginate: PaginateFunction }) {
  return paginate(project, { pageSize: 6 })
}

type projectProps = {
  slug: string
  data: {
    title: string
    description: string
    heroImage: string
    pubDate: string
    tags: string[]
  }
}

const { page } = Astro.props
const { prev, next } = page.url
---

<AppPage title={`${SITE_TITLE} - Projekty & Aplikace`}>
  <Content class="py-10">
    <ul class="fadeIn grid w-full grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3">
      {
        page.data.map((project: projectProps) => (
          <li class="page_project w-full translate-y-10 rounded-2xl border border-primary_light p-4 opacity-0 shadow-md shadow-primary_dark transition-colors duration-200 hover:bg-primary_light/20">
            <a href={`/project/${project.slug}/`} class="block">
              <div class="h-52 w-full overflow-hidden rounded-xl  shadow-primary_dark outline outline-4 outline-primary_light">
                <Image
                  format="avif"
                  quality="mid"
                  width={1280}
                  height={720}
                  src={project.data.heroImage}
                  alt=""
                  class="project_img mb-2 h-full w-full object-cover "
                />
              </div>
              <article class="mt-5">
                <p class="text-center text-gray-400">
                  <FormattedDate date={new Date(project.data.pubDate)} />
                </p>
                <h4 class="text-center text-xl font-bold text-accent_1">{project.data.title}</h4>
                <div class="overflow-hidden">
                  <TagIcon
                    tags={project.data.tags}
                    iconClass="w-6 h-6"
                    class="project_skills translate-y-full pt-4 opacity-0"
                  />
                </div>
              </article>
              <Spacer class="my-4" />
              <p class="text-gray-300">{truncateDescription(project.data.description, 200)}</p>
            </a>
          </li>
        ))
      }
    </ul>

    <!-- Pagination controls -->
    <section class="flex justify-center pt-10">
      {
        prev && (
          <HyperLink
            href={prev}
            class="mx-2 rounded-md border border-primary_light px-4 py-2 transition-colors duration-300 hover:bg-primary_light/20"
            data-action="next"
          >
            Předchozí stránka
          </HyperLink>
        )
      }
      {
        next && (
          <HyperLink
            href={next}
            class="mx-2 rounded-md border border-primary_light px-4 py-2 transition-colors duration-300 hover:bg-primary_light/20"
            data-action="next"
          >
            Další stránka
          </HyperLink>
        )
      }
    </section>
  </Content>
</AppPage>

<script src="../../animation/animateProjectPage.ts"></script>
